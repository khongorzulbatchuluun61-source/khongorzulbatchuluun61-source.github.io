<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админ - Мэдээ оруулах</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; color:#333; }
  header { background:#0077cc; color:#fff; padding:15px 20px; text-align:center; }
  h1 { margin:0; font-size:28px; }
  main { max-width:900px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  form { display:flex; flex-direction:column; gap:15px; }
  input, textarea { padding:10px; font-size:14px; border-radius:5px; border:1px solid #ccc; width:100%; box-sizing:border-box; }
  button { padding:10px; background:#0077cc; color:#fff; border:none; border-radius:5px; font-weight:bold; cursor:pointer; }
  button:hover { background:#005fa3; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { border:1px solid #ccc; padding:8px; text-align:left; }
  th { background:#0077cc; color:#fff; }
  .btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; color:#fff; font-weight:bold; }
  .edit-btn { background:#ffa500; }
  .delete-btn { background:#ff4444; }
</style>
</head>
<body>

<header>
  <h1>Админ - Мэдээ удирдах</h1>
</header>

<main>
  <h2>Мэдээ нэмэх</h2>
  <form id="news-form">
    <input type="text" id="title" placeholder="Гарчиг" required>
    <textarea id="description" placeholder="Мэдээний текст" rows="4" required></textarea>
    <input type="text" id="image" placeholder="Зургийн URL" required>
    <input type="text" id="category" placeholder="Ангилал (Соёл, Спорт гэх мэт)" required>
    <input type="date" id="date" required>
    <button type="submit">Нэмэх</button>
  </form>

  <h2>Мэдээний жагсаалт</h2>
  <table>
    <thead>
      <tr>
        <th>Гарчиг</th>
        <th>Ангилал</th>
        <th>Огноо</th>
        <th>Засах</th>
        <th>Устгах</th>
      </tr>
    </thead>
    <tbody id="news-list">
      <!-- Мэдээ Firebase-аас ирнэ -->
    </tbody>
  </table>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

  // Firebase тохиргоо
  const firebaseConfig = {
    apiKey: "AIzaSyCEZS_SYNYTM49tlk8VQXTXcHW2poSJdEI",
    authDomain: "khongorzul-news.firebaseapp.com",
    databaseURL: "https://khongorzul-news-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "khongorzul-news",
    storageBucket: "khongorzul-news.firebasestorage.app",
    messagingSenderId: "489440213839",
    appId: "1:489440213839:web:b11ae043901031220a633a",
    measurementId: "G-BJKJVZYKLL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const newsForm = document.getElementById("news-form");
  const newsList = document.getElementById("news-list");

  let editingKey = null;

  // Мэдээ нэмэх / засах
  newsForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const image = document.getElementById("image").value.trim();
    const category = document.getElementById("category").value.trim();
    const date = document.getElementById("date").value;

    if (!title || !description || !image || !category || !date) return alert("Бүх талбарыг бөглөнө үү");

    const newsData = { title, description, image, category, date };

    if (editingKey) {
      update(ref(db, "news/" + editingKey), newsData);
      editingKey = null;
    } else {
      push(ref(db, "news"), newsData);
    }

    newsForm.reset();
  });

  // Firebase-аас мэдээ татах
  const newsRef = ref(db, "news");
  onValue(newsRef, (snapshot) => {
    newsList.innerHTML = "";
    const data = snapshot.val();
    if (data) {
      Object.keys(data).reverse().forEach(key => {
        const news = data[key];
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${news.title}</td>
          <td>${news.category}</td>
          <td>${news.date}</td>
          <td><button class="btn edit-btn">Засах</button></td>
          <td><button class="btn delete-btn">Устгах</button></td>
        `;

        // Засах товч
        tr.querySelector(".edit-btn").addEventListener("click", () => {
          document.getElementById("title").value = news.title;
          document.getElementById("description").value = news.description;
          document.getElementById("image").value = news.image;
          document.getElementById("category").value = news.category;
          document.getElementById("date").value = news.date;
          editingKey = key;
        });

        // Устгах товч
        tr.querySelector(".delete-btn").addEventListener("click", () => {
          if (confirm("Энэ мэдээг устгах уу?")) {
            remove(ref(db, "news/" + key));
          }
        });

        newsList.appendChild(tr);
      });
    }
  });
</script>

</body>
</html>
